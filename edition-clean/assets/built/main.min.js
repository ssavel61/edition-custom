function dropdown(){let o=window.matchMedia("(max-width: 767px)"),i=document.querySelector(".gh-head-menu"),r=i?.querySelector(".nav");if(r){let e=document.querySelector(".gh-head-logo"),t=r.innerHTML;o.matches&&r.querySelectorAll("li").forEach(function(e,t){e.style.transitionDelay=.03*(t+1)+"s"});let n=function(){if(!o.matches){for(var e=[];r.offsetWidth+64>i.offsetWidth&&r.lastElementChild;)e.unshift(r.lastElementChild),r.lastElementChild.remove();if(e.length){let t=document.createElement("button"),n=(t.setAttribute("class","nav-more-toggle gh-icon-btn"),t.setAttribute("aria-label","More"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor"><path d="M21.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0zM13.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0zM5.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0z"></path></svg>',document.createElement("div"));n.setAttribute("class","gh-dropdown"),10<=e.length?(document.body.classList.add("is-dropdown-mega"),n.style.gridTemplateRows=`repeat(${Math.ceil(e.length/2)}, 1fr)`):document.body.classList.remove("is-dropdown-mega"),e.forEach(function(e){n.appendChild(e)}),t.appendChild(n),r.appendChild(t),document.body.classList.add("is-dropdown-loaded"),window.addEventListener("click",function(e){document.body.classList.contains("is-dropdown-open")?document.body.classList.remove("is-dropdown-open"):t.contains(e.target)&&document.body.classList.add("is-dropdown-open")})}else document.body.classList.add("is-dropdown-loaded")}};imagesLoaded(e,function(){n()}),window.addEventListener("load",function(){e||n()}),window.addEventListener("resize",function(){setTimeout(()=>{r.innerHTML=t,n()},1)})}}function lightbox(e){document.querySelectorAll(e).forEach(function(e){e.addEventListener("click",function(e){var t=e;t.preventDefault();for(var n,o=[],i=0,r=t.target.closest(".kg-card").previousElementSibling;r&&(r.classList.contains("kg-image-card")||r.classList.contains("kg-gallery-card"));){var a=[];r.querySelectorAll("img").forEach(function(e){a.push({src:e.getAttribute("src"),msrc:e.getAttribute("src"),w:e.getAttribute("width"),h:e.getAttribute("height"),el:e}),i+=1}),r=r.previousElementSibling,o=a.concat(o)}t.target.classList.contains("kg-image")?o.push({src:t.target.getAttribute("src"),msrc:t.target.getAttribute("src"),w:t.target.getAttribute("width"),h:t.target.getAttribute("height"),el:t.target}):(n=!1,t.target.closest(".kg-gallery-card").querySelectorAll("img").forEach(function(e){o.push({src:e.getAttribute("src"),msrc:e.getAttribute("src"),w:e.getAttribute("width"),h:e.getAttribute("height"),el:e}),n||e===t.target?n=!0:i+=1}));for(var s=t.target.closest(".kg-card").nextElementSibling;s&&(s.classList.contains("kg-image-card")||s.classList.contains("kg-gallery-card"));)s.querySelectorAll("img").forEach(function(e){o.push({src:e.getAttribute("src"),msrc:e.getAttribute("src"),w:e.getAttribute("width"),h:e.getAttribute("height"),el:e})}),s=s.nextElementSibling;e=document.querySelectorAll(".pswp")[0];new PhotoSwipe(e,PhotoSwipeUI_Default,o,{bgOpacity:.9,closeOnScroll:!0,fullscreenEl:!1,history:!1,index:i,shareEl:!1,zoomEl:!1,getThumbBoundsFn:function(e){var e=o[e].el,t=window.pageYOffset||document.documentElement.scrollTop,e=e.getBoundingClientRect();return{x:e.left,y:e.top+t,w:e.width}}}).init()})})}function pagination(isInfinite) {
    var feed = document.querySelector('.gh-feed');
    var nav = document.querySelector('.pagination');
    var next = document.querySelector('link[rel="next"]');
    var loadMore = document.querySelector('.older-posts');
    var marker = document.querySelector('#infinite-scroll-marker');

    if (!feed || !nav || !marker) return;

    if (loadMore) {
        nav.style.display = 'block';
    }

    function fetchNextPage() {
        var nextLink = document.querySelector('link[rel="next"]');
        if (!nextLink) return;

        var url = nextLink.getAttribute('href');
        if (loading === true) return;

        nav.classList.add('loading');
        loading = true;

        var xhr = new XMLHttpRequest();
        xhr.open('GET', url);
        xhr.responseType = 'document';

        xhr.onload = function () {
            if (xhr.status >= 200 && xhr.status < 400) {
                var newNodes = xhr.response.querySelectorAll('.gh-feed > *');
                var nextLinkUrl = xhr.response.querySelector('link[rel="next"]');

                newNodes.forEach(function (node) {
                    feed.appendChild(document.importNode(node, true));
                });

                if (nextLinkUrl) {
                    nextLink.setAttribute('href', nextLinkUrl.getAttribute('href'));
                } else {
                    if (marker) marker.remove();
                    nav.remove();
                }

                nav.classList.remove('loading');
                loading = false;
            }
        };

        xhr.send();
    }

    var loading = false;

    if (isInfinite) {
        var observer = new IntersectionObserver(function (entries) {
            entries.forEach(function (entry) {
                if (entry.isIntersecting) {
                    fetchNextPage();
                }
            });
        });
        if (marker) {
            observer.observe(marker);
        }
    } else {
        if (loadMore) {
            loadMore.addEventListener('click', function (e) {
                e.preventDefault();
                fetchNextPage();
            });
        }
    }
}

// Re-initialize everything
var html = document.documentElement;
var body = document.body;
var timeout;
var st = 0;

function portalButton() {
    st = window.scrollY;
    if (st > 300) {
        body.classList.add('portal-visible');
    } else {
        body.classList.remove('portal-visible');
    }
}

function cover() {
    var cover = document.querySelector('.cover');
    if (cover) {
        imagesLoaded(cover, function () {
            cover.classList.remove('image-loading');
        });
        document.querySelector('.cover-arrow').addEventListener('click', function () {
            cover.nextElementSibling.scrollIntoView({behavior: 'smooth', block: 'start'});
        });
    }
}

function featured() {
    var feed = document.querySelector('.featured-feed');
    if (feed) {
        tns({
            container: feed,
            controlsText: [
                '<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M20.547 22.107L14.44 16l6.107-6.12L18.667 8l-8 8 8 8 1.88-1.893z"></path></svg>',
                '<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M11.453 22.107L17.56 16l-6.107-6.12L13.333 8l8 8-8 8-1.88-1.893z"></path></svg>',
            ],
            gutter: 30,
            loop: false,
            nav: false,
            responsive: {
                0: { items: 1 },
                768: { items: 2 },
                992: { items: 3 },
            },
        });
    }
}

cover();
featured();
pagination(true);

window.addEventListener('scroll', function () {
    if (body.classList.contains('home-template') && body.classList.contains('with-full-cover') && !document.querySelector('.cover').classList.contains('half')) {
        if (timeout) {
            window.cancelAnimationFrame(timeout);
        }
        timeout = window.requestAnimationFrame(portalButton);
    }
});

if (document.querySelector('.cover') && document.querySelector('.cover').classList.contains('half')) {
    body.classList.add('portal-visible');
}
